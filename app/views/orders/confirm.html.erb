<!-- 注文情報確認画面 -->
<div class="container">
  <div class="my-3 row">
    <div class="col-lg-4 d-flex justify-content-center" style="background-color: secondarys" >
      <h4 class="px-3 mb-3 bg-secondary text-white">注文情報確認</h4>
    </div>
  </div>

  <div class="row">
    <div class="col-lg-7">
      <table class="table table-bordered border-dark">
        <tr class="table-active">
          <th scope="col" style="width: 44%">商品名</th>
          <th scope="col" style="width: 14%">単価(税込)</th>
          <th scope="col" style="width: 14%">数量</th>
          <th scope="col" style="width: 14%">小計</th>
        </tr>
        <% @sum = 0 %>
        <% @cart_items.each do |cart_item| %>
        <tr>
          <td>
            <%= attachment_image_tag cart_item.item, :image, :fill, 75, 50, format: 'jpeg', class:"mx-2 exmaple-hoge" %>
            <%= cart_item.item.name %>
          </td>
          <td class="align-middle">
            <%= cart_item.item.with_tax_price.to_s(:delimited) %>
          </td>
          <td class="align-middle">
            <%= cart_item.amount %>
          </td>
          <td class="align-middle">
            <%= cart_item.subtotal.to_s(:delimited) %>
            <% @sum += cart_item.subtotal %>
          </td>
        </tr>
      <% end %>
      </table>
    </div>

    <div class="col-lg-4">
      <table class="table table-bordered border-dark">
        <tr class="align-middle">
          <th class="table-active" scope="col" style="width: 50%" >
            <p>送料</p>
          </th>
          <td scope="col" style="width: 50%">800</td>
        </tr>
        <tr class="align-middle">
          <th class="table-active" >
            <p>商品合計</p>
          </th>
          <td><%= @sum.to_s(:delimited) %></td>
        </tr>
        <tr class="align-middle">
          <th class="table-active" >
            <p>
              請求金額
            </p>
          </th>
          <td>
              <%= (@sum += 800).to_s(:delimited)  %>
          </td>
        </tr>
      </table>
    </div>
  </div>

  <div class="mt-5 row">
    <div class="col-lg-12 d-flex justify-content-start">
      <h5 class="mr-3"><strong>支払方法</strong></h5>
      <div class="lead">
      <%= @order.payment_method_i18n %>
      </div>
    </div>
  </div>
  <div class="mt-5 row">
    <div class="col-lg-12 d-flex justify-content-start">
      <h5 class="mr-3"><strong>お届け先</strong></h5>
      <%= @order.full_address %><br />
      <%= @order.name %>
      </div>
    </div>
  </div>

<%= form_with model: @order, url: orders_path, local: true do |f| %>
<%= f.hidden_field :customer_id, :value => current_customer.id %>
<%= f.hidden_field :postal_code %>
<%= f.hidden_field :address %>
<%= f.hidden_field :name %>
<%= f.hidden_field :shipping_cost, :value => 800 %>
<%= f.hidden_field :total_payment, :value => @sum %>
<%= f.hidden_field :status, :value => Order.statuses.key(0) %>

  <div class="mt-5 row">
    <div class="col-lg-11 d-flex justify-content-center">
      <%= f.submit "注文を確定する", class: "px-4 py-2 mx-4 btn btn-success" %>
    </div>
  </div>
<% end %>
</div>